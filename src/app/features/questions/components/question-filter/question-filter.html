<ng-container *ngIf="exibirBotoes">
  <h5 class="mb-3">Filtros Avançados</h5>
  <hr class="mt-0 mb-4 opacity-25">
</ng-container>

<div *ngIf="estaLogado" class="premium-filter-container mb-4" [class.is-locked]="!isPremium">
  <h6 class="filter-title premium-header">
    Recursos Premium 
    <svg width="22" height="22" fill="currentColor" class="bi bi-crown-fill premium-badge-overlay" viewBox="0 0 24 24">
      <path d="M2 4l3 12h14l3-12-6 7-4-7-4 7-6-7z"></path>
    </svg>
  </h6>
    
  <div class="d-flex flex-wrap gap-3 mt-2 mb-4">
    <div class="form-check">
      <input class="form-check-input" type="checkbox" id="checkErros"
             [(ngModel)]="filtrosEstaticos.premium.apenasErros"
             [disabled]="!isPremium"
             (change)="onStaticChange()">
      <label class="form-check-label small fw-medium" for="checkErros">
        Meus Erros
      </label>
    </div>

    <div class="form-check">
      <input class="form-check-input" type="checkbox" id="checkResolucao"
             [(ngModel)]="filtrosEstaticos.premium.comResolucao"
             [disabled]="!isPremium" 
             (change)="onStaticChange()">
      <label class="form-check-label small fw-medium" for="checkResolucao">
        Resolução texto
      </label>
    </div>

    <div class="form-check">
      <input class="form-check-input" type="checkbox" id="checkVideo"
             [(ngModel)]="filtrosEstaticos.premium.comVideo"
             [disabled]="!isPremium"
             (change)="onStaticChange()">
      <label class="form-check-label small fw-medium" for="checkVideo">
        Resolução vídeo
      </label>
    </div>
  </div>
  <div *ngIf="!isPremium" class="text-center mt-1">
    <span class="text-warning fw-bold" style="font-size: 0.7rem; cursor: pointer;" (click)="irParaPremium()">
      LIBERAR RECURSOS PREMIUM
    </span>
  </div>
</div>

<!-- Seção Disciplina -->
<div class="filter-group mb-4">
  <h6 class="filter-title">Disciplina</h6>
  <div class="form-check mb-2">
    <input class="form-check-input" type="checkbox" id="checkMatematica"
           [(ngModel)]="filtrosEstaticos.disciplina['Matematica']"
           (change)="onStaticChange()">
    <label class="form-check-label" for="checkMatematica">
      Matemática
    </label>
  </div>
  <div class="form-check mb-2">
    <input class="form-check-input" type="checkbox" id="checkPortugues"
           [(ngModel)]="filtrosEstaticos.disciplina['Linguagens']"
           (change)="onStaticChange()">
    <label class="form-check-label" for="checkPortugues">
      Linguagens
    </label>
  </div>
  <div class="form-check mb-2">
    <input class="form-check-input" type="checkbox" id="checkHistoria"
           [(ngModel)]="filtrosEstaticos.disciplina['Humanas']"
           (change)="onStaticChange()">
    <label class="form-check-label" for="checkHistoria">
      Humanas
    </label>
  </div>

  <div *ngFor="let item of outrasDisciplinas; let i = index; trackBy: trackByIndex">
    <div class="form-check d-flex align-items-center mb-2"
         (mouseenter)="checkDisabledHover('disciplina', i)"
         (mouseleave)="hideWarning('disciplina')">
      
      <input class="form-check-input" 
             type="checkbox" 
             [id]="'checkOutraDisciplina' + i"
             [(ngModel)]="item.checked"
             (ngModelChange)="onCheckboxToggle('disciplina', i)"
             (change)="onStaticChange()">
      
      <div class="ms-2 flex-grow-1">
        <input type="text" 
               class="form-control form-control-sm extra-input" 
               placeholder="Digite outra disciplina..."
               [(ngModel)]="item.value"
               (input)="onOutroInput('disciplina', i)"
               [disabled]="!item.checked"
               (change)="onStaticChange()">
      </div>
    </div>
  </div>
</div>

<!-- Seção Dificuldade -->
<div class="filter-group mb-4">
  <h6 class="filter-title">Dificuldade</h6>

  <div class="form-check mb-2">
    <input class="form-check-input" type="checkbox" id="checkFacil"
           [(ngModel)]="filtrosEstaticos.dificuldade['FACIL']"
           (change)="onStaticChange()">
    <label class="form-check-label" for="checkFacil">Fácil</label>
  </div>
  <div class="form-check mb-2">
    <input class="form-check-input" type="checkbox" id="checkMedia"
           [(ngModel)]="filtrosEstaticos.dificuldade['MEDIO']"
           (change)="onStaticChange()">
    <label class="form-check-label" for="checkMedia">Média</label>
  </div>
  <div class="form-check mb-2">
    <input class="form-check-input" type="checkbox" id="checkDificil"
           [(ngModel)]="filtrosEstaticos.dificuldade['DIFICIL']"
           (change)="onStaticChange()">
    <label class="form-check-label" for="checkDificil">Difícil</label>
  </div>
</div>

<!-- Seção Instituição -->
<div class="filter-group mb-4">
    <h6 class="filter-title">Instituição</h6>
    
    <div class="form-check mb-2">
        <input class="form-check-input" type="checkbox" id="checkFuvest"
               [(ngModel)]="filtrosEstaticos.instituicao['FGV']"
               (change)="onStaticChange()">
        <label class="form-check-label" for="checkFuvest">
          FGV
        </label>
    </div>
    <div class="form-check mb-2">
        <input class="form-check-input" type="checkbox" id="checkEnem"
               [(ngModel)]="filtrosEstaticos.instituicao['Enem']"
               (change)="onStaticChange()">
        <label class="form-check-label" for="checkEnem">
          Enem
        </label>
    </div>
    <div class="form-check mb-2">
        <input class="form-check-input" type="checkbox" id="checkEnade"
               [(ngModel)]="filtrosEstaticos.instituicao['Enade']"
               (change)="onStaticChange()">
        <label class="form-check-label" for="checkEnade">
          Enade
        </label>
    </div>

    <!-- Loop dinâmico (correto) -->
    <div *ngFor="let item of outrasInstituicoes; let i = index; trackBy: trackByIndex">
      <div class="form-check d-flex align-items-center mb-2"
           (mouseenter)="checkDisabledHover('instituicao', i)"
           (mouseleave)="hideWarning('instituicao')">
        
        <input class="form-check-input" 
               type="checkbox" 
               [id]="'checkOutraInstituicao' + i"
               [(ngModel)]="item.checked"
               (ngModelChange)="onCheckboxToggle('instituicao', i)"
               (change)="onStaticChange()">
        
        <div class="ms-2 flex-grow-1">
          <input type="text" 
                 class="form-control form-control-sm extra-input" 
                 placeholder="Digite outra instituição..."
                 [(ngModel)]="item.value"
                 (input)="onOutroInput('instituicao', i)"
                 [disabled]="!item.checked"
                 (change)="onStaticChange()">
        </div>
      </div>
    </div>
</div>

<!-- Seção Ano -->
<div class="filter-group mb-4">
    <h6 class="filter-title">Ano</h6>
    
    <div class="form-check mb-2">
        <input class="form-check-input" type="checkbox" id="checkAno2025"
               [(ngModel)]="filtrosEstaticos.ano['2025']"
               (change)="onStaticChange()">
        <label class="form-check-label" for="checkAno2025">
          2025
        </label>
    </div>
    <div class="form-check mb-2">
        <input class="form-check-input" type="checkbox" id="checkAno2024"
               [(ngModel)]="filtrosEstaticos.ano['2024']"
               (change)="onStaticChange()">
        <label class="form-check-label" for="checkAno2024">
          2024
        </label>
    </div>
    <div class="form-check mb-2">
        <input class="form-check-input" type="checkbox" id="checkAno2023"
               [(ngModel)]="filtrosEstaticos.ano['2023']"
               (change)="onStaticChange()">
        <label class="form-check-label" for="checkAno2023">
          2023
        </label>
    </div>

    <!-- Loop dinâmico (correto) -->
    <div *ngFor="let item of outrosAnos; let i = index; trackBy: trackByIndex">
      <div class="form-check d-flex align-items-center mb-2"
           (mouseenter)="checkDisabledHover('ano', i)"
           (mouseleave)="hideWarning('ano')">
        
        <input class="form-check-input" 
               type="checkbox" 
               [id]="'checkOutroAno' + i"
               [(ngModel)]="item.checked"
               (ngModelChange)="onCheckboxToggle('ano', i)"
               (change)="onStaticChange()">
        
        <div class="ms-2 flex-grow-1">
          <input type="number" 
                 class="form-control form-control-sm extra-input" 
                 placeholder="Digite outro ano..."
                 [(ngModel)]="item.value"
                 (input)="onOutroInput('ano', i)"
                 [disabled]="!item.checked"
                 (change)="onStaticChange()">
        </div>
      </div>
    </div>
</div>

<!-- 
  LIGANDO O BOTÃO
  Adiciona (click)="aplicarFiltros()"
-->
<div class="d-grid gap-2 mt-3" *ngIf="exibirBotoes">
  
  <!-- Botão 1: Aplicar -->
  <button class="btn btn-primary w-100 rounded-pill" 
          (click)="aplicarFiltros()">
    Aplicar Filtros
  </button>
  
  <!-- Botão 2: Limpar (NOVO) -->
  <!-- 'btn-outline-secondary' dá um visual "leve" -->
  <button type="button" class="btn btn-outline-secondary w-100 rounded-pill"
          (click)="limparFiltros()">
    Limpar Filtros
  </button>

</div>